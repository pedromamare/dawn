{% comment %}
  Seletor de tipos de fonte com imagens
  Baseado em detalhes-do-produto-01.html e detalhes-do-produto-02.html
  Para produtos personalizáveis com escolha de tipografia

  Uso:
  {% render 'variant-selector-fonts',
    product: product,
    option_name: 'Tipo de letra',
    show_message: true,
    custom_message: 'Prazo de 5 dias úteis para peças personalizadas'
  %}

  IMPORTANTE: Mapeamento de valores para imagens:
  - Moderna → 01-fonts.avif
  - Sem Serifa → 02-fonts.avif
  - Antiga → 03-fonts.avif
  - Caligráfica → 04-fonts.avif
  - Decorativa → 05-fonts.avif
{% endcomment %}

{% liquid
  assign option_index = nil
  assign option_found = nil

  for option in product.options_with_values
    if option.name == option_name
      assign option_index = forloop.index0
      assign option_found = option
      break
    endif
  endfor
%}

{% if option_found != nil %}
  <div class="option-component divisao-itens">
    <div product="title" class="text-style-allcaps text-color-primary">{{ option_name }}</div>

    <div class="variant-button-row">
      {% for value in option_found.values %}
        {% liquid
          assign is_available = false
          assign matching_variant = nil
          assign is_first = false

          if forloop.first
            assign is_first = true
          endif

          for variant in product.variants
            assign variant_value = nil

            if option_index == 0
              assign variant_value = variant.option1
            elsif option_index == 1
              assign variant_value = variant.option2
            elsif option_index == 2
              assign variant_value = variant.option3
            endif

            if variant_value == value
              assign matching_variant = variant
              if variant.available
                assign is_available = true
              endif
              break
            endif
          endfor

          # Mapear valores das fontes para números de imagem
          # Moderna → 01-fonts.avif
          # Sem Serifa → 02-fonts.avif
          # Antiga → 03-fonts.avif
          # Caligráfica → 04-fonts.avif
          # Decorativa → 05-fonts.avif

          assign font_image_name = ''
          assign value_lower = value | downcase

          if value_lower contains 'moderna' or value_lower contains 'modern'
            assign font_image_name = '01-fonts.avif'
          elsif value_lower contains 'sem serifa' or value_lower contains 'sans serif' or value_lower contains 'serifa'
            assign font_image_name = '02-fonts.avif'
          elsif value_lower contains 'antiga' or value_lower contains 'old' or value_lower contains 'vintage'
            assign font_image_name = '03-fonts.avif'
          elsif value_lower contains 'caligr' or value_lower contains 'script' or value_lower contains 'cursive'
            assign font_image_name = '04-fonts.avif'
          elsif value_lower contains 'decorativa' or value_lower contains 'decorative' or value_lower contains 'display'
            assign font_image_name = '05-fonts.avif'
          else
            # Fallback: usa ordem do loop
            assign font_number = forloop.index
            if font_number > 5
              assign font_number = 5
            endif
            assign font_image_name = '0' | append: font_number | append: '-fonts.avif'
          endif
        %}

        <div
          option="bg-color"
          class="letras-itens {% unless is_available %}is-disabled{% endunless %} {% if is_first %}is-active{% endif %}"
          data-option-index="{{ option_index }}"
          data-option-value="{{ value | escape }}"
          {% if matching_variant %}
            data-variant-id="{{ matching_variant.id }}"
            data-variant-available="{{ matching_variant.available }}"
          {% endif %}
          onclick="selectVariantOption(this)"
        >
          <img
            loading="lazy"
            src="{{ font_image_name | asset_url }}"
            alt="{{ value | escape }}"
            class="letras-img"
          >
        </div>
      {% endfor %}
    </div>

    {% if show_message and custom_message %}
      <div class="text-size-tiny text-color-brand2">{{ custom_message }}<br></div>
    {% endif %}
  </div>
{% endif %}
