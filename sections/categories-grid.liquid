{% comment %}
  Categories Grid - DINÂMICO
  Grid de categorias puxando collections automaticamente
  Exclui collections: 283391754311, 283391819847, 283376156743
{% endcomment %}

{%- liquid
  assign excluded_collection_ids = '283391754311,283391819847,283376156743' | split: ','
  assign max_collections = section.settings.max_collections | default: 8
  assign collections_to_show = collections | where: 'all_products_count' | sort: 'all_products_count' | reverse
-%}

<section class="section_categorias">
  <div class="padding-global">
    <div class="padding-section-medium">
      <div class="margin-bottom-2 margin-medium">
        <div class="text-align-center">
          <div class="max-width-large-2 align-center">
            <div class="margin-bottom-2 margin-small">
              <h2>{{ section.settings.title | default: 'Pesquise por Categorias' }}</h2>
            </div>
          </div>
        </div>
      </div>

      <div class="home8-customers_component">
        {%- assign count = 0 -%}
        {%- for coll in collections_to_show -%}
          {%- if count >= max_collections -%}
            {%- break -%}
          {%- endif -%}

          {%- assign coll_id_string = coll.id | append: '' -%}
          {%- unless excluded_collection_ids contains coll_id_string -%}
            {%- if coll.all_products_count > 0 -%}
              <a href="{{ coll.url }}" class="categorias-iten w-inline-block">
                {%- liquid
                  assign collection_image = null
                  if coll.image
                    assign collection_image = coll.image
                  elsif coll.featured_image
                    assign collection_image = coll.featured_image
                  elsif coll.products.first.featured_image
                    assign collection_image = coll.products.first.featured_image
                  endif
                -%}

                {%- if collection_image -%}
                  <img src="{{ collection_image | image_url: width: 577 }}"
                       loading="lazy"
                       alt="{{ coll.title }}"
                       sizes="(max-width: 577px) 100vw, 577px"
                       srcset="{{ collection_image | image_url: width: 500 }} 500w,
                               {{ collection_image | image_url: width: 577 }} 577w"
                       class="icon-categorias">
                {%- else -%}
                  <div class="icon-categorias placeholder-image" style="background: #f0f0f0; display: flex; align-items: center; justify-content: center;">
                    <span style="color: #999;">{{ coll.title | slice: 0, 1 }}</span>
                  </div>
                {%- endif -%}
                <p class="text-categorias">{{ coll.title }}</p>
              </a>
              {%- assign count = count | plus: 1 -%}
            {%- endif -%}
          {%- endunless -%}
        {%- endfor -%}
      </div>
    </div>
  </div>
</section>

{% schema %}
{
  "name": "Grid de Categorias",
  "tag": "section",
  "class": "section-categories-grid",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Título",
      "default": "Pesquise por Categorias"
    },
    {
      "type": "range",
      "id": "max_collections",
      "min": 4,
      "max": 12,
      "step": 1,
      "default": 8,
      "label": "Número máximo de categorias"
    },
    {
      "type": "paragraph",
      "content": "As categorias são carregadas automaticamente das collections da loja, ordenadas por número de produtos. Collections vazias ou excluídas não aparecem."
    }
  ],
  "presets": [
    {
      "name": "Grid de Categorias"
    }
  ]
}
{% endschema %}
